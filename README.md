# Кот или хлеб

# Общее описание

Это телеграмм бот, который позволяет определить, что подразумевает пользователь - кота или хлеба.

Бот реализует работу в двух режимах - текстовом и с использованием картинок.

В текстовом режиме бот задает пользователю наводящие вопросы:
1) Объект перед тобой квадратный?

2) У него есть уши?

Пользователь может отвечать фразы, обозначающие "да" или "нет" (об интерпретации ответов пользователя ниже)

При использовании картинок бот может распознать, нарисован ли на картинке кот. Переход на данный режим осуществляется загрузкой картинки в бота (в сжатом формате)

# Скриншоты работы бота

![pic1](https://github.com/divergg/telegramBotCatOrBread/blob/master/pic1.PNG)

![pic2](https://github.com/divergg/telegramBotCatOrBread/blob/master/pic2.PNG)

![pic3](https://github.com/divergg/telegramBotCatOrBread/blob/master/pic3.PNG)

![pic4](https://github.com/divergg/telegramBotCatOrBread/blob/master/pic4.PNG)

# Общая структура проекта

Проект состоит из двух частей - бэкенд (Django-Rest Framework, PostgreSQL) и фронтенд (aiogram).

Основная реализация происходит на стороне бэкенда (2 API View). Бэкенд покрыт тестами.



# Схема URL API проекта

http://django:8000/bot/ - принимает текстовые комманды в формате {'id': str, 'message': str}

http://django:8000/bot/image - принимает изображения в формате {'id': str, 'image': file}

http://django:8000/docs/ - документация

http://django:8000/admin/ - админ панель

# Модель распознования текста

Для распознования ответов используется предварительная подготовленная модель (/botBacken/backCommands/interpretation_model/textmodel)

Стэк модели - библиотека Spacy.

С помощью модели осуществлена разметка слов по категориям 'YES', 'NO', 'UNKNOWN', исходя из которых в последствии определяются ответы бота.

Ссылка на исходный код - https://github.com/divergg/yes_no_model

При распознавании текста добавлена возможность игнорирования знаков препинания и регистра

# Модель распознования изображений

Путь - /botBacken/backCommands/interpretation_model/imagemodel

Стэк модели - библиотека OpenCV. Использованиа уже существующая библиотека из репозитория OpenCV.

Может определить "кота" от "не кота"

# Схема базы данных

В базу данных добавлены три модели:

Profile (модель пользователя). Поля: Имя пользователя в телеграмм; текущий шаг в диалоге (сервисное поле); дата создания

Message (модель сообщений). Поля: пользователь, создавший сообщение; Изначальный текст сообщения пользователя;
Преобразованный текст сообщения пользователя (YES, NO, UNKNOWN); Ответ бота (выбирается из заранее написанных ответов);
Ссылка на изображение, переданное пользователем (при наличии); дата создания


Image (модель  изображения). Поле: файл с изображением

Описание моделей содержится в файле models.py

# Порядок запуска

1) Клонировать репозиторий (git clone)

2) Создать файл .env, где указать token для телеграм бота (API_TOKEN) и секретный ключ приложения Django (SECRET_KEY)

3) Запустить docker образ (docker compose up)




 
